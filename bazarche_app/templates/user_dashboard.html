{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans 'پروفایل من' %}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-body text-center">
                    <img src="{% if user.userprofile.avatar %}{{ user.userprofile.avatar.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" alt="Profile Picture" class="rounded-circle mb-3" style="width: 100px; height: 100px; object-fit: cover;">
                    <h5 class="card-title mb-1">{{ user.userprofile.full_name|default:user.username }}</h5>
                    <p class="text-muted small mb-2">{% trans "شناسه کاربر" %}: {{ user.userprofile.profile_id }}</p>
                    <p class="text-muted small mb-2">{{ user.userprofile.contact }}</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'app:edit_profile' %}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil me-2"></i>{% trans "ویرایش پروفایل" %}
                        </a>
                        <a href="{% url 'app:change_password' %}" class="btn btn-outline-warning btn-sm">
                            <i class="bi bi-key me-2"></i>{% trans "تغییر رمز عبور" %}
                        </a>
                    </div>
                </div>
                <hr>
                <div class="nav flex-column nav-pills">
                    <a class="nav-link active" href="#my-ads" data-bs-toggle="pill">
                        <i class="bi bi-box me-2"></i>{% trans "آگهی‌های من" %}
                    </a>
                    <a class="nav-link" href="#my-requests" data-bs-toggle="pill">
                        <i class="bi bi-chat-dots me-2"></i>درخواستی‌های من
                    </a>
                    <a class="nav-link" href="#suggested" data-bs-toggle="pill">
                        <i class="bi bi-star me-2"></i>{% trans "پیشنهادات" %}
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <div class="tab-content">
                <!-- My Ads Tab -->
                <div class="tab-pane fade show active" id="my-ads">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{% trans "آگهی‌های من" %}</h5>
                            <a href="{% url 'app:register_product' %}" class="btn btn-primary btn-sm">
                                <i class="bi bi-plus-lg me-2"></i>{% trans "ثبت آگهی جدید" %}
                            </a>
                        </div>
                        <div class="card-body">
                            {% if products %}
                                <div class="row">
                                    {% for product in products %}
                                        <div class="col-md-4 mb-4">
                                            {% include 'partials/product_card.html' with product=product is_user_dashboard=True %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="alert alert-info text-center" role="alert">
                                    <i class="bi bi-info-circle me-2"></i>
                                    {% trans "شما هنوز هیچ آگهی ثبت نکرده اید." %}
                                    <br>
                                    <a href="{% url 'app:register_product' %}" class="btn btn-primary mt-2">
                                        <i class="bi bi-plus-lg me-2"></i>{% trans "ثبت اولین آگهی" %}
                                    </a>
                                </div>
                            {% endif %}
                            <!-- Job Ads Section -->
                            <hr>
                            <h5 class="mb-3 mt-4">آگهی‌های شغلی من</h5>
                            {% if user_jobads %}
                                <div class="row">
                                    {% for job in user_jobads %}
                                    <div class="col-md-6 col-lg-4 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="fw-bold">{{ job.title }}</h6>
                                                {% if job.city %}
                                                <div class="small text-muted mb-2">{{ job.city.name }}</div>
                                                {% endif %}
                                                <div class="mb-2">{{ job.description|truncatechars:60 }}</div>
                                                <div class="text-success small mb-2">تماس: {{ job.contact }}</div>
                                                <div class="text-secondary small mb-2">تاریخ ثبت: {{ job.created_at|date:'Y/m/d' }}</div>
                                                <form action="{% url 'app:delete_jobad' job.pk %}" method="post" onsubmit="return confirm('آیا مطمئن هستید که می‌خواهید این آگهی شغلی را حذف کنید؟');">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-danger btn-sm">حذف</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="alert alert-info text-center small">شما هیچ آگهی شغلی ثبت نکرده‌اید.</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- My Requests Tab -->
                <div class="tab-pane fade" id="my-requests">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">درخواستی‌های من</h5>
                            <a href="{% url 'app:request_create' %}" class="btn btn-primary btn-sm">
                                <i class="bi bi-plus-lg me-2"></i>ثبت درخواست جدید
                            </a>
                        </div>
                        <div class="card-body">
                            {% if user_requests %}
                                <div class="row">
                                    {% for request in user_requests %}
                                    <div class="col-md-6 col-lg-4 mb-3">
                                        <div class="card h-100" style="border-left: 4px solid #667eea;">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <h6 class="card-title mb-0" style="color: #667eea;">
                                                        <i class="bi bi-person me-1"></i>{{ request.contact }}
                                                    </h6>
                                                    <small class="text-muted">{{ request.created_at|date:"Y/m/d" }}</small>
                                                </div>
                                                <p class="card-text" style="font-size: 0.9rem; line-height: 1.5;">
                                                    {{ request.request_text|truncatechars:100 }}
                                                </p>
                                                <form action="{% url 'app:delete_user_request' request.pk %}" method="post" onsubmit="return confirm('آیا مطمئن هستید که می‌خواهید این درخواست را حذف کنید؟');">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-danger btn-sm">
                                                        <i class="bi bi-trash me-1"></i>حذف
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="alert alert-info text-center" role="alert">
                                    <i class="bi bi-chat-dots me-2"></i>
                                    شما هنوز هیچ درخواستی ثبت نکرده‌اید.
                                    <br>
                                    <a href="{% url 'app:request_create' %}" class="btn btn-primary mt-2">
                                        <i class="bi bi-plus-lg me-2"></i>ثبت اولین درخواست
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Suggested Products Tab -->
                <div class="tab-pane fade" id="suggested">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">{% trans "محصولات پیشنهادی" %}</h5>
                        </div>
                        <div class="card-body">
                            {% if suggested_products %}
                                <div class="row">
                                    {% for product in suggested_products %}
                                        <div class="col-md-4 mb-4">
                                            {% include 'partials/product_card.html' with product=product is_user_dashboard=False %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="alert alert-info" role="alert">
                                    <i class="bi bi-info-circle me-2"></i>
                                    {% trans "در حال حاضر محصول پیشنهادی برای شما وجود ندارد." %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .sidebar {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
    }
    .nav-pills .nav-link {
        color: #495057;
        padding: 0.8rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        transition: all 0.3s ease;
    }

    .nav-pills .nav-link:hover {
        background-color: #e9ecef;
    }

    .nav-pills .nav-link.active {
        background-color: #007bff;
        color: #fff;
    }

    .nav-pills .nav-link i {
        margin-left: 0.5rem;
    }

    .card {
        border: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        border-radius: 12px;
    }

    .card-header {
        background-color: #fff;
        border-bottom: 1px solid #f0f0f0;
        padding: 1rem 1.5rem;
    }

    .card-body {
        padding: 1.5rem;
    }

    .btn-primary {
        padding: 0.5rem 1rem;
        border-radius: 8px;
    }

    .btn-outline-primary {
        padding: 0.5rem 1rem;
        border-radius: 8px;
    }

    .form-control {
        border-radius: 8px;
        padding: 0.6rem 1rem;
    }

    .form-check-input {
        margin-top: 0.2rem;
    }

    @media (max-width: 768px) {
        .col-md-3 {
            margin-bottom: 1.5rem;
        }
    }
</style>
{% endblock %}
